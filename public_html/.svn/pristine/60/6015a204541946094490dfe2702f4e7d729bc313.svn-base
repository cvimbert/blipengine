
var IntervalDispatcher = function () {
    
    var timeInterv;
    var pauseTimeout;
    var nextStepTime;
    var timeBeforeNextStep = 0;
    var lastTime;
    
    var pCallback;
    var pTime;
    var paused = false;
    
    this.init = function (callback, time) {
        pCallback = callback;
        pTime = time;
    };

    this.start = function () {
        paused = false;
        
        pauseTimeout = setTimeout(pauseRelease, timeBeforeNextStep);
    };

    this.pause = function () {
        paused = true;
        clearInterval(timeInterv);
        clearTimeout(pauseTimeout);
        timeInterv = null;
        pauseTimeout = null;
        
        var dt = new Date();
        timeBeforeNextStep = nextStepTime - dt.getTime();
    };

    this.stop = function () {

    };
    
    function execCallback() {
        pCallback();
        var dt = new Date();
        lastTime = dt.getTime();
        nextStepTime = dt.getTime() + pTime;
    }
    
    function pauseRelease() {
        pCallback();
        
        if (!timeInterv) {
            timeInterv = setInterval(execCallback, pTime);
        }
    }
};